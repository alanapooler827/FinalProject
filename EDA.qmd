---
title: "Exploratory Data Analysis"
author: "Alana Pooler"
date: "2025-11-19"
format: html
---

# Introduction

The data used in this project comes from the 2015 Behavioral Risk Factor Surveillance System report conducted by the CDC. View the data set on [Kaggle](https://www.kaggle.com/datasets/alexteboul/diabetes-health-indicators-dataset/?select=diabetes_binary_health_indicators_BRFSS2015.csv).

The data set contains 22 variables. The variable 'Diabetes_binary' (diabetes or no diabetes) will be used as the response variable for modeling. This leaves 21 variables as potential predictors, which include information like whether or not the subject has high blood pressure, BMI, age, general health rating (self-assessed), and more. The cleaned data set from Kaggle contains 253,680 survey responses.

We will first explore the data and investigate the relationships between variables to get a sense of what variables could be useful for modeling. Then, we will build two models to predict the Diabetes_binary variable using a selection of the 21 predictor variables. We will be building a classification tree and a random forest model and evaluating the predictions from each to determine the best model.

# Data Preparation

Import libraries

```{r}
#| output: false
library(tidyverse)
library(ggplot2)
```

Read in data

```{r}
#| warning: false
#| output: false
df <- read_csv('diabetes_binary_health_indicators_BRFSS2015.csv')
```

```{r}
# view first few rows of data
head(df)
```


Check for missing values

No missing values in any column

```{r}
sum_na <- function(column){
 sum(is.na(column))
}

df |> summarize(across(everything(), sum_na))
```

View column types

All of the variables are numeric, but most of them are categorical variables encoded as numbers, so we will need to change those

```{r}
sapply(df, class)
```

Look at unique values of each variable to see which ones should be converted into factors

```{r}
sapply(df, table)
```

Convert columns to factors where appropriate

```{r}
# specify columns to skip
skip_convert <- c('BMI', 'MentHlth', 'PhysHlth')

# convert all other columns to factors
df <- df |>
  mutate(across(-all_of(skip_convert), as.factor))
```

Recode factor levels for better interpretability

First recode all variables that have levels of Yes/No

```{r}
# skip variables that are not factors or do not have levels of yes/no 
skip_recode <- c('BMI', 'GenHlth', 'MentHlth', 'PhysHlth',
                 'Sex', 'Age', 'Education', 'Income')

lvl_map <- c("0" = "No", "1" = "Yes")

df <- df |>
  mutate(across(-all_of(skip_recode), ~ recode(.x, !!!lvl_map)))
```

Recode remaining variables

```{r}
df <- df |>
  mutate(
    GenHlth = fct_recode(
      GenHlth,
      'Excellent' = '1',
      'Very Good' = '2',
      'Good' = '3',
      'Fair' = '4',
      'Poor' = '5'
    ),
    Sex = fct_recode(
      Sex,
      'Female' = '0',
      'Male' = '1'
    ),
    Age = fct_recode(
      Age,
      '18-24' = '1',
      '25-29' = '2',
      '30-34' = '3',
      '35-39' = '4',
      '40-44' = '5',
      '45-49' = '6',
      '50-54' = '7',
      '55-59' = '8',
      '60-64' = '9',
      '65-69' = '10',
      '70-74' = '11',
      '75-79' = '12',
      '80+' = '13'
      ),
    Education = fct_recode(
      Education,
      'None' = '1',
      'Elementary School' = '2',
      'Some High School' = '3',
      'High School' = '4',
      'Some College' = '5',
      'College Graduate' = '6',
      ),
    Income = fct_recode(
      Income,
      "Less than $10k" = "1",
      "$10k to < $15k" = "2",
      "$15k to < $20k" = "3",
      "$20k to < $25k" = "4",
      "$25k to < $35k" = "5",
      "$35k to < $50k" = "6",
      "$50k to < $75k" = "7",
      "$75k or more" = "8"
      ),
    ) |>
  # rename Diabetes_binary
  rename('diabetes_status' = 'Diabetes_binary')
```


# Data Exploration

Now we will look at some graphical and numerical summaries.

Number of participants without diabetes vs with diabetes

The data is very imbalanced, most participants do not have diabetes.

```{r}
ggplot(df, aes(x = diabetes_status)) +
  geom_bar(fill = 'deepskyblue4') +
  theme_minimal()
```

Two-way contingency tables for Diabetes Status by all other categorical variables

We want to identify a subset of variables that may be useful predictors for diabetes status, and comparing diabetes prevalence across the levels of each variable can give us an initial idea.

We can expect to that the proportions for participants without diabetes will be higher overall since there is a much larger number of those participants overall.

A pattern that sticks out is that the proportion of participants with diabetes increase with age until ages 75+, when the proportion decreases.

Another pattern is that participants without diabetes have higher proportions for exercising, having health care coverage, eating fruits and veggies, no heart issues, and no heavy alcohol consumption. Some of these may be helpful predictor variables for modeling.

```{r}
cat_vars <- names(df)[sapply(df, is.factor)]
# remove diabetes_status from the list so we don't two way table with itself
cat_vars <- setdiff(cat_vars, "diabetes_status")

for (v in cat_vars) {
  cat("\n")
  cat("diabetes_status by", v, "\n")
  print(round(prop.table(table(df$diabetes_status, df[[v]])), 3))
}
```

Box Plot of BMI vs Diabetes Status

Not as much difference between the groups of diabetes status as I expected. This may not be the most userful variable to use as a predictor in the models.

```{r}
ggplot(df, aes(x = diabetes_status, y = BMI)) +
  geom_boxplot(fill = "deepskyblue4") +
  labs(x = "Diabetes Status",
       y = "BMI",
       title = "BMI Distribution by Diabetes Status")
```

Diabetes status by Age

In the no diabetes group, age 60-64 has the most subjects, whereas the diabetes group has the most subjects in the 65-69 age range.

```{r}
ggplot(df, aes(x = diabetes_status, fill = Age)) +
  geom_bar(position='dodge') +
  labs(x = 'Diabetes Status',
       title = 'Diabetes Status by Sex')
```

Diabetes Status by General Health Rating

In the no diabetes group, most subjects rated their general health as 'very good', whereas most of the subjects in the diabetes group rated their health as 'good; or 'fair'.

```{r}
ggplot(df, aes(x = diabetes_status, fill = GenHlth)) +
  geom_bar(position='dodge') +
  labs(x = 'Diabetes Status',
       title = 'Diabetes Status by General Health Rating')
```

Diabetes Status grouped by High Blood Pressure

There is a clear relationship between HighBP and diabetes status, with more people in the Diabetes group having high blood pressure. This could be a useful predictor variable for modeling.

```{r}
ggplot(df, aes(x = diabetes_status, fill = HighBP)) +
  geom_bar(position='dodge') +
  labs(x = 'Diabetes Status',
       title = 'Diabetes Status by High Blood Pressure (Yes/No)')
```

Diabetes Status grouped by High Cholesterol

This plot is almost identical to the diabetes status by HighBP plot. The number of subjects with high cholesterol is much lower than the number of subjects without high cholesterol in the no diabetes group, and vice versa for the diabetes group.

```{r}
ggplot(df, aes(x = diabetes_status, fill = HighChol)) +
  geom_bar(position='dodge') +
  labs(x = 'Diabetes Status',
       title = 'Diabetes Status by High Cholesterol (Yes/No)')
```

Distributions of PhysHlth and MentHlth

The distributions are almost identical, both are heavily skewed to the right- most subjects had no days of injury/illness or poor mental health in the last 30 days.

```{r}
ggplot(df, aes(x = PhysHlth)) +
  geom_histogram(binwidth = 5, fill = "deepskyblue4") +
  labs(x = '# of Days Physically Injured/Ill in Past 30 Days',
       title = 'Distribution of Physical Health')

ggplot(df, aes(x = MentHlth)) +
  geom_histogram(binwidth = 5, fill = "deepskyblue4") +
  labs(x = '# of Days of Poor Mental Health in Past 30 Days',
       title = 'Distribution of Physical Health')
```

Diabetes Status vs Difficulty Walking

There does not appear to be an obvious relationship between diabetes status and difficulty walking based on this plot. Both diabetes status groups have more subjects who do not have difficulty walking. 
```{r}
ggplot(df, aes(x = diabetes_status, fill = DiffWalk)) +
  geom_bar(position='dodge') +
  labs(x = 'Difficulty Walking/Climbing Stairs (Y/N)',
       title = 'Diabetes Status by Difficulty Walking')
```
Education Level by Diabetes Status

The no diabetes group has a clear upward trend in number of subjects as the education level increases, with most subjects holding a college degree. In the no diabetes group, few subjects have only an elementary school or high school education, but we do not see the same trend after that. The high school and above education levels all have roughly the same number of subjects with high school level having slightly more subjects than some college and college degree.
```{r}
ggplot(df, aes(x = Education, fill = Education)) +
  geom_bar() +
  facet_wrap(~ diabetes_status, nrow = 2) +
  theme(axis.text.x = element_blank(), axis.ticks.x = element_blank()) +
  labs(x = 'Education Level',
       title = 'Education Level by Diabetes Status')
```
Diabetes Status by Income

Like education level, there is an increase in the number of subjects in each group of income level as it increases for the no diabetes group. The majority of subjects in this group have an income of over $75k. The no diabetes group has roughly the same number of subjects at each income level with a very slight increase in the number of subjects per group as income level increases.
```{r}
ggplot(df, aes(x = Income, fill = Income)) +
  geom_bar() +
  facet_wrap(~ diabetes_status, nrow = 2) +
  theme(axis.text.x = element_blank(), axis.ticks.x = element_blank()) +
  labs(x = 'Income',
       title = 'Diabetes Status by Education Level')
```

Click [here](Modeling.html) to Visit the Modeling Page

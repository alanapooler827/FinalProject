---
title: "Exploratory Data Analysis"
author: "Alana Pooler"
date: "2025-11-19"
format: html
---

## Introduction

The data used in this project comes from the 2015 Behavioral Risk Factor Surveillance System report conducted by the CDC. View the data set on [Kaggle](https://www.kaggle.com/datasets/alexteboul/diabetes-health-indicators-dataset/?select=diabetes_binary_health_indicators_BRFSS2015.csv).

The data set contains 22 variables. The variable 'Diabetes_binary' will be used as the response variable and has the values 0 for no diabetes and 1 for prediabetes or diabetes. This leaves 21 variables as predictor variables, which include information like gender, BMI, age, general health, and more.

We will first explore the data and investigate the relationships between variables to get a sense of what variables could be useful for modeling. Then, we will build a models to predict the Diabetes_binary variable using a selection of the 21 predictor variables. We will be building a classification tree and a random forest model and evaluating the predictions from each to determine the best model.

## Data Preparation

Import libraries

```{r include=FALSE}
library(tidyverse)
library(ggplot2)
```

Read in data

```{r}
df <- read_csv("diabetes_binary_health_indicators_BRFSS2015.csv")

# view first few rows of data
head(df)
```

Check for missing values

No missing values in any column

```{r}
sum_na <- function(column){
 sum(is.na(column))
}

df |> summarize(across(everything(), sum_na))
```

View column types

All of the variables are numeric, but most of them are categorical variables encoded as numbers, so we will need to change those

```{r}
sapply(df, class)
```

Look at unique values of each variable to see which ones should be converted into factors

```{r}
sapply(df, table)
```

Convert columns to factors where appropriate

```{r}
# specify columns to skip
skip_convert <- c('BMI', 'MentHlth', 'PhysHlth')

# convert all other columns to factors
df <- df |>
  mutate(across(-all_of(skip_convert), as.factor))
```

Recode factor levels for better interpretability

First recode all variables that have levels of Yes/No

```{r}
# skip variables that are not factors or do not have levels of yes/no 
skip_recode <- c('Diabetes_binary', 'BMI', 'GenHlth', 'MentHlth',
                 'PhysHlth', 'Sex', 'Age', 'Education', 'Income')

lvl_map <- c("0" = "No", "1" = "Yes")

df <- df |>
  mutate(across(-all_of(skip_recode), ~ recode(.x, !!!lvl_map)))
```

Recode remaining variables

```{r}
df <- df |>
  mutate(
    Diabetes_binary = fct_recode(
      Diabetes_binary,
      'None' = '0',
      'Prediabetes/Diabetes' = '1'
    ),
    GenHlth = fct_recode(
      GenHlth,
      'Excellent' = '1',
      'Very Good' = '2',
      'Good' = '3',
      'Fair' = '4',
      'Poor' = '5'
    ),
    Sex = fct_recode(
      Sex,
      'Female' = '0',
      'Male' = '1'
    ),
    Age = fct_recode(
      Age,
      '18-24' = '1',
      '25-29' = '2',
      '30-34' = '3',
      '35-39' = '4',
      '40-44' = '5',
      '45-49' = '6',
      '50-54' = '7',
      '55-59' = '8',
      '60-64' = '9',
      '65-69' = '10',
      '70-74' = '11',
      '75-79' = '12',
      '80+' = '13'
      ),
    Education = fct_recode(
      Education,
      'None' = '1',
      'Elementary School' = '2',
      'Some High School' = '3',
      'High School' = '4',
      'Some College' = '5',
      'College Graduate' = '6',
      ),
    Income = fct_recode(
      Income,
      "Less than $10k" = "1",
      "$10k to < $15k" = "2",
      "$15k to < $20k" = "3",
      "$20k to < $25k" = "4",
      "$25k to < $35k" = "5",
      "$35k to < $50k" = "6",
      "$50k to < $75k" = "7",
      "$75k or more" = "8"
      ),
    )
```

## Data Exploration

Now we will look at some graphical and numerical summaries.

Number of participants without diabetes vs with prediabetes/diabetes

The data is very imbalanced, most participants do not have prediabetes/diabetes.

```{r}
ggplot(df, aes(x = Diabetes_binary)) +
  geom_bar(fill = 'deepskyblue4') +
  theme_minimal()
```

Two-way contingency tables for Diabetes Status by all other categorical variables

We can expect to that the proportions for participants without prediabetes/diabetes will be higher overall since there is a much larger number of those participants overall.

A pattern that sticks out is that the proportion of participants with prediabetes/diabetes increase with age until ages 75+, when the proportion decreases.

Another pattern is that participants without diabetes have higher proportions for exercising, having health care coverage, eating fruits and veggies, no heart issues, and no heavy alcohol consumption. Some of these may be helpful predictor variables for modeling.

```{r}
cat_vars <- names(df)[sapply(df, is.factor)]
# remove Diabetes_binary from the list so we don't two way table with itself
cat_vars <- setdiff(cat_vars, "Diabetes_binary")

for (v in cat_vars) {
  cat("\n")
  cat("Diabetes_binary by", v, "\n")
  print(round(prop.table(table(df$Diabetes_binary, df[[v]])), 3))
}
```

Box Plot of BMI vs Diabetes Status

Not as much difference between the groups of diabetes status as I expected. This may not be the most userful variable to use as a predictor in the models.

```{r}
ggplot(df, aes(x = Diabetes_binary, y = BMI)) +
  geom_boxplot(fill = "deepskyblue4") +
  labs(x = "Diabetes Status",
       y = "BMI",
       title = "BMI Distribution by Diabetes Status")
```

Age vs Diabetes status

In the no diabetes group, age 60-64 has the most subjects, whereas the prediabetes/diabetes group has the most subjects in the 65-69 age range.

```{r}
ggplot(df, aes(x = Diabetes_binary, fill = Age)) +
  geom_bar(position='dodge') +
  labs(x = 'Diabetes Status',
       title = 'Diabetes Status by Sex')
```

Diabetes Status grouped by HighBP

There is a clear relationship between HighBP and Diabetes_binary, with more people in the Prediabetes/Diabetes group having high blood pressure. This could be a useful predictor variable for modeling.

```{r}
ggplot(df, aes(x = Diabetes_binary, fill = HighBP)) +
  geom_bar(position='dodge') +
  labs(x = 'Diabetes Status',
       title = 'Diabetes Status by High Blood Pressure (Yes/No)')
```
